<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23ff9f43' d='M50 0C22.4 0 0 22.4 0 50s22.4 50 50 50 50-22.4 50-50S77.6 0 50 0zm0 8C73.2 8 92 26.8 92 50S73.2 92 50 92 8 73.2 8 50 26.8 8 50 8zm0 18c-8.3 0-15 6.7-15 15s6.7 15 15 15 15-6.7 15-15-6.7-15-15-15z'/%3E%3C/svg%3E">
    <title>Ultimate Egg Boiler Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8c003d; /* Default Orange */
            --secondary-color: #feca57;
            --accent-color: #ff6b6b;
            --background-start:#ff6da7;
            --background-end: #ff9f3f;
            --text-color: #3d3d3d;
            --card-bg: rgba(255, 255, 255, 0.25); /* More transparent */
            --card-shadow: rgba(45, 52, 54, 0.1);
            --border-color: rgba(255, 255, 255, 0.5);
            --ai-user-msg-bg: color-mix(in srgb, var(--primary-color) 25%, transparent);
            --ai-bot-msg-bg: rgba(255, 255, 255, 0.4);
        }

        /* Dark Mode Styles */
        body.dark-mode {
            --background-start: #2d3436;
            --background-end: #000000;
            --text-color: #f0f0f0;
            --card-bg: rgba(10, 10, 10, 0.2);
            --card-shadow: rgba(0,0,0,0.25);
            --border-color: rgba(255, 255, 255, 0.15);
            --ai-bot-msg-bg: rgba(45, 52, 54, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Quicksand', sans-serif;
        }

        body {
            background-image: linear-gradient(120deg, var(--background-start), var(--background-end));
            color: var(--text-color);
            min-height: 100vh;
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            transition: background-image 0.5s ease, color 0.5s ease;
            position: relative;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 650px;
            margin: 0 auto;
            z-index: 1;
        }
        
        .background-circle {
            position: fixed;
            border-radius: 50%;
            background-image: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            opacity: 0.1;
            z-index: -1;
            animation: move 30s infinite alternate;
            filter: blur(50px);
        }

        .circle1 { width: 400px; height: 400px; top: 5%; left: 10%; }
        .circle2 { width: 600px; height: 600px; bottom: 0%; right: 5%; animation-duration: 40s; }
        
        @keyframes move {
          0% { transform: translateY(0) translateX(0) scale(1); }
          100% { transform: translateY(-80px) translateX(50px) scale(1.2); }
        }

        header { text-align: center; margin-bottom: 2rem; animation: fadeIn 1s ease-out; }
        h1 { font-family: 'Poppins', sans-serif; font-size: clamp(2.2rem, 6vw, 3.2rem); margin-bottom: 0.25rem; font-weight: 700; text-shadow: 0 2px 15px rgba(0,0,0,0.1);}
        .tagline { font-size: clamp(1rem, 3.5vw, 1.2rem); opacity: 0.8; margin-bottom: 1rem; }
        
        .egg-master-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 25px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0, 0.15);
            transition: all 0.2s ease-in-out;
            display: inline-block;
        }
        
        .egg-master-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px color-mix(in srgb, var(--primary-color) 40%, #000);
        }

        .card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 15px 40px var(--card-shadow);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(25px); /* Increased blur for glassier effect */
            -webkit-backdrop-filter: blur(25px);
            animation: slideUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
            position: relative;
            overflow: hidden;
        }
        /* Glossy edge effect */
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 24px;
            pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.15), transparent, rgba(255, 255, 255, 0.15));
        }

        .card:nth-of-type(2) { animation-delay: 0.1s; }
        .card:nth-of-type(3) { animation-delay: 0.2s; }
        .card:nth-of-type(4) { animation-delay: 0.3s; }

        h2.section-title {
            font-size: clamp(1.4rem, 4vw, 1.7rem);
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        /* Egg Selector */
        .egg-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1.5rem; }
        .egg-type {
            background: transparent; border-radius: 20px; padding: 1.5rem 1rem;
            text-align: center; cursor: pointer; border: 2px solid var(--border-color);
            opacity: 0.7; transition: all 0.3s ease;
        }
        .egg-type:hover { transform: translateY(-8px) scale(1.03); opacity: 1; border-color: var(--primary-color); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .egg-type.selected {
            border: 3px solid var(--primary-color); background: var(--ai-user-msg-bg);
            transform: translateY(-5px) scale(1.05); opacity: 1; box-shadow: 0 10px 30px -5px var(--primary-color);
        }
         .egg-type i { font-size: 2.8rem; color: var(--primary-color); margin-bottom: 1rem; }
         .egg-type h3 { margin-bottom: 0.5rem; font-weight: 600; font-size: 1.1rem; }
         .egg-type p { font-size: 0.9rem; opacity: 0.8; }
         
        /* Timer Area */
        .timer-area { display: flex; align-items: center; justify-content: center; gap: 2rem; flex-wrap: wrap; }
        .egg-animation-container { width: 120px; height: 120px; }
        .timer-display { font-size: clamp(4rem, 15vw, 5rem); font-weight: bold; font-family: 'Poppins', monospace; color: var(--primary-color); text-shadow: 0 0 20px color-mix(in srgb, var(--primary-color) 30%, transparent);}
        .timer-controls { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin-top: 1.5rem; }
        button {
            background: var(--primary-color); border: none; color: white; padding: 0.8rem 1.75rem;
            border-radius: 50px; cursor: pointer; font-weight: 600; font-size: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0, 0.15); display: flex; align-items: center; gap: 0.5rem;
            transition: all 0.2s ease-in-out;
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 6px 20px color-mix(in srgb, var(--primary-color) 40%, #000); }
        button:active { transform: translateY(1px); box-shadow: 0 2px 10px rgba(0,0,0, 0.2); }
        .stop-btn { background: var(--accent-color); }
        .reset-btn { background: #8395a7; }

        /* Optichain Boiler AI */
        .ai-response {
            background-color: var(--background-start); border-radius: 15px; padding: 1rem; 
            margin-top: 1rem; min-height: 150px; border: 1px solid var(--border-color);
            max-height: 350px; overflow-y: auto; display: flex; flex-direction: column;
        }
        .ai-message {
            margin-bottom: 0.75rem; padding: 0.7rem 1.1rem; border-radius: 18px;
            max-width: 85%; line-height: 1.5; animation: slideIn 0.5s ease-out forwards;
            clear: both; box-shadow: 0 3px 8px rgba(0,0,0,0.07); position: relative;
        }
        .user-message { background-color: var(--ai-user-msg-bg); margin-left: auto; text-align: left; float: right; }
        .ai-message-content { background-color: var(--ai-bot-msg-bg); margin-right: auto; float: left; }
        .ai-message.is-typing {
            font-style: italic;
            color: #8395a7;
        }
        .ai-message.is-typing span {
            display: inline-block;
            animation: bounce 1s infinite;
        }
        .ai-message.is-typing span:nth-child(2) { animation-delay: 0.1s; }
        .ai-message.is-typing span:nth-child(3) { animation-delay: 0.2s; }
        
        .ai-message-content strong { color: var(--primary-color); }
        .ai-message-content ul, .ai-message-content ol { padding-left: 1.2rem; }
        .ai-message-content li { margin-bottom: 0.5rem; }
        .ai-input-container { display: flex; margin-top: 1rem; gap: 0.75rem; }
        #aiInput {
            flex: 1; padding: 0.75rem 1.25rem; border-radius: 25px; 
            border: 2px solid var(--border-color); background: var(--card-bg); 
            color: var(--text-color); transition: border-color 0.3s;
        }
        #aiInput:focus { outline: none; border-color: var(--primary-color); }
        #sendAiBtn {
            border-radius: 50%; width: 50px; height: 50px; padding: 0;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
            background: #6c5ce7;
        }

        /* Customization Card */
        .customization-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 1.5rem;
        }
        .customization-header h2 { margin-bottom: 0; }
        #hideCustomizationBtn {
            background: #8395a7;
            font-size: 0.9rem;
            padding: 0.5rem 1.2rem;
        }
        .customization-content {
             display: flex; flex-direction: column; gap: 2rem; align-items: center;
             transition: all 0.5s ease;
             max-height: 500px;
             overflow: hidden;
        }
        .customization-content.is-hidden {
            max-height: 0;
            gap: 0;
            padding: 0;
            opacity: 0;
        }
        .custom-section {width: 100%; text-align: center;}
        .custom-section h3 { margin-bottom: 1rem; font-weight: 600;}
        .color-picker { display: flex; gap: 1.5rem; justify-content: center; }
        .color-option { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: transform 0.2s, border-color 0.2s; }
        .color-option:hover { transform: scale(1.1); }
        .color-option.selected { border-color: var(--primary-color); transform: scale(1.15); box-shadow: 0 0 15px var(--primary-color); }
        .dark-mode-toggle { display: flex; align-items: center; justify-content: center; gap: 1rem; }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px;}
        .switch input { opacity: 0; width: 0; height: 0;}
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; border-radius: 34px; transition: .4s;}
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; border-radius: 50%; transition: .4s;}
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(22px); }

        .footer { text-align: center; margin-top: 2rem; padding: 1rem; font-size: 1rem; opacity: 0.8; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .user-message { animation-name: slideInUser; }
        @keyframes slideInUser { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

    </style>
</head>
<body>
    <div class="background-circle circle1"></div>
    <div class="background-circle circle2"></div>

    <div class="container">
        <header>
            <h1>Ultimate Egg Boiler Pro</h1>
            <p class="tagline">Perfect eggs, intelligently timed, with a world of recipes at your fingertips.</p>
            <a href="1.html" class="egg-master-btn">Egg Master</a>
        </header>

        <!-- Settings Card -->
        <div class="card egg-settings">
            <h2 class="section-title"><i class="fas fa-egg"></i>1. Choose Your Doneness</h2>
            <div class="egg-selector">
                 <div class="egg-type selected" data-time="240" data-id="soft" data-progress-end="0.3">
                    <i class="fas fa-tint-slash"></i><h3>Soft Boiled</h3><p>Runny yolk</p>
                </div>
                <div class="egg-type" data-time="360" data-id="medium" data-progress-end="0.6">
                     <i class="fas fa-adjust"></i><h3>Medium Boiled</h3><p>Jammy yolk</p>
                </div>
                <div class="egg-type" data-time="540" data-id="hard" data-progress-end="0.9">
                     <i class="fas fa-circle"></i><h3>Hard Boiled</h3><p>Set yolk</p>
                </div>
                <div class="egg-type" data-time="720" data-id="welldone" data-progress-end="1.0">
                     <i class="fas fa-egg"></i><h3>Well Done</h3><p>Fully cooked</p>
                </div>
            </div>
            <h2 class="section-title" style="margin-top: 2.5rem;"><i class="fas fa-sliders-h"></i>2. Fine-Tune Settings</h2>
             <div class="advanced-settings" style="display: flex; justify-content: space-around; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                 <div class="setting" style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <label for="eggSize">Egg Size</label>
                    <select id="eggSize" style="background: var(--background-start); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 10px; padding: 0.5rem 0.75rem;">
                        <option value="0" selected>Medium</option>
                        <option value="60">Large (+1 min)</option>
                        <option value="120">X-Large (+2 min)</option>
                    </select>
                </div>
                <div class="setting" style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <label for="altitude">Altitude (meters)</label>
                    <input type="number" id="altitude" value="0" step="100" style="background: var(--background-start); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 10px; padding: 0.5rem; width: 100px; text-align: center;">
                </div>
                 <div class="setting" style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <label for="quantity">Quantity</label>
                    <input type="number" id="quantity" value="1" min="1" max="12" style="background: var(--background-start); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 10px; padding: 0.5rem; width: 100px; text-align: center;">
                </div>
            </div>
        </div>
        
        <!-- Timer Card -->
        <div class="card timer-container">
            <h2 class="section-title"><i class="fas fa-stopwatch"></i>3. Start Cooking</h2>
            <div class="timer-area">
                <div class="egg-animation-container" id="eggAnimation">
                    <svg viewBox="0 0 100 125" style="--yolk-color: #FFC300; --yolk-opacity: 0.8;">
                        <path fill="#f0f0f0" d="M50,5 C25,5 10,40 10,70 C10,100 25,115 50,115 C75,115 90,100 90,70 C90,40 75,5 50,5 Z"/>
                        <circle id="yolk" cx="50" cy="70" r="25" fill="var(--yolk-color)" opacity="var(--yolk-opacity)" style="transition: all 1s linear;"/>
                    </svg>
                </div>
                <div class="timer-display" id="timer">04:00</div>
            </div>
            <div class="timer-controls">
                <button class="start-btn" id="startBtn" aria-label="Start Timer"><i class="fas fa-play"></i>Start</button>
                <button class="stop-btn" id="stopBtn" aria-label="Pause Timer"><i class="fas fa-pause"></i>Pause</button>
                <button class="reset-btn" id="resetBtn" aria-label="Reset Timer"><i class="fas fa-redo"></i>Reset</button>
            </div>
        </div>

        <!-- AI Chat Card -->
        <div class="card" id="aiBoiler">
            <h2 class="section-title"><i class="fas fa-robot"></i>Optichain Boiler AI</h2>
            <p style="text-align:center;">Ask "What can I make with eggs and bread?"</p>
            <div class="ai-response" id="aiResponse">
                <div class="ai-message ai-message-content">
                    Hello! I've been upgraded. You can now ask me for recommendations based on the ingredients you have. How can I help you today?
                </div>
            </div>
            <div class="ai-input-container">
                <input type="text" id="aiInput" placeholder="I have eggs, cheese, tortillas...">
                <button id="sendAiBtn" aria-label="Send message to AI"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <!-- Customization Card -->
        <div class="card customization">
             <div class="customization-header">
                <h2 class="section-title"><i class="fas fa-palette"></i>Customize</h2>
                <button id="hideCustomizationBtn"><i class="fas fa-check"></i> Done</button>
             </div>
             <div class="customization-content" id="customizationContent">
                <div class="custom-section">
                    <h3>Theme Color</h3>
                     <div class="color-picker" id="colorPicker">
                        <div class="color-option selected" style="background-color: #ff9f43;" data-primary="#ff9f43" title="Sunset Orange"></div>
                        <div class="color-option" style="background-color: #54a0ff;" data-primary="#54a0ff" title="Ocean Blue"></div>
                        <div class="color-option" style="background-color: #a29bfe;" data-primary="#a29bfe" title="Aurora Violet"></div>
                        <div class="color-option" style="background-color: #2ecc71;" data-primary="#2ecc71" title="Zen Green"></div>
                        <div class="color-option" style="background-color: #ff7979;" data-primary="#ff7979" title="Coral Pink"></div>
                    </div>
                </div>
                 <div class="custom-section">
                    <div class="dark-mode-toggle">
                        <h3>Dark Mode</h3>
                        <label class="switch">
                          <input type="checkbox" id="darkModeToggle">
                          <span class="slider"></span>
                        </label>
                    </div>
                 </div>
             </div>
        </div>

        <div class="footer">
             <p>Enhanced with <i class="fas fa-heart" style="color: var(--accent-color);"></i> by your AI Assistant</p>
        </div>
    </div>
    <audio id="alarmSound" src="https://assets.mixkit.co/sfx/preview/mixkit-kitchen-microwave-1106.mp3" preload="auto"></audio>

<script>
document.addEventListener('DOMContentLoaded', () => {
    
    // --- Service Worker for Background Timer ---
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
            .then(reg => console.log('Service worker registered successfully'))
            .catch(err => console.log('Service worker registration failed: ', err));
    }

    const UIElements = {
        timerDisplay: document.getElementById('timer'),
        startBtn: document.getElementById('startBtn'),
        stopBtn: document.getElementById('stopBtn'),
        resetBtn: document.getElementById('resetBtn'),
        eggTypes: document.querySelectorAll('.egg-type'),
        alarmSound: document.getElementById('alarmSound'),
        colorPicker: document.getElementById('colorPicker'),
        yolk: document.getElementById('yolk'),
        eggSize: document.getElementById('eggSize'),
        altitude: document.getElementById('altitude'),
        quantity: document.getElementById('quantity'),
        darkModeToggle: document.getElementById('darkModeToggle'),
        aiInput: document.getElementById('aiInput'),
        sendAiBtn: document.getElementById('sendAiBtn'),
        aiResponse: document.getElementById('aiResponse'),
        hideCustomizationBtn: document.getElementById('hideCustomizationBtn'),
        customizationContent: document.getElementById('customizationContent'),
    };

    const AppState = {
        countdown: null,
        totalSeconds: 240,
        secondsRemaining: 240,
        baseTime: 240,
        progressTarget: 0.3,
        isRunning: false,
    };

    const EggData = {
        recipes: {
            // --- AI DATA ENHANCED WITH INGREDIENTS ---
            scrambledeggs: {
                name: "Perfect Scrambled Eggs",
                keywords: ["scrambled", "scramble", "fluffy"],
                ingredients: ["egg", "milk", "butter"],
                description: "A breakfast classic. Making them is easy, but a few simple tricks take them from good to great!",
                details: `<strong>Ingredients:</strong><ul><li>2 large Eggs</li><li>2 tsp Milk (optional)</li><li>1/2 tbsp Butter</li><li>Salt and freshly ground black pepper</li></ul><strong>Instructions:</strong><ol><li>Lightly whisk the eggs, milk (if using), salt, and pepper.</li><li>Melt the butter in a small nonstick skillet over medium-low heat.</li><li>Pour in the egg mixture. Let cook for a few seconds without stirring.</li><li>Gently pull the eggs across the pan with a spatula until large, soft curds form.</li><li>Remove from the heat when they are still slightly moist. They will continue to cook. Serve immediately.</li></ol>`
            },
             shakshuka: {
                name: "Shakshuka",
                keywords: ["shakshuka", "middle east", "north africa", "poached"],
                 ingredients: ["egg", "onion", "pepper", "garlic", "tomato", "tomato sauce"],
                description: "A delicious dish of eggs poached in a flavorful tomato and pepper sauce.",
                details: `<strong>Ingredients:</strong><ul><li>1 tbsp Olive Oil</li><li>1 large Onion, chopped</li><li>1 red Bell Pepper, chopped</li><li>3 cloves Garlic, minced</li><li>1 tsp Cumin & Paprika</li><li>1 (28-ounce) can Crushed Tomatoes</li><li>6 large Eggs</li><li>Feta cheese and Parsley for garnish</li></ul><strong>Instructions:</strong><ol><li>Heat oil in a large skillet. Sauté onion and bell pepper until soft.</li><li>Stir in garlic and spices. Pour in tomatoes, season, and simmer for 10 minutes.</li><li>Make small wells in the sauce and crack an egg into each one.</li><li>Cover and cook for 5-8 minutes, until egg whites are set but yolks are runny.</li><li>Garnish and serve with crusty bread.</li></ol>`
            },
            avocadotoast: {
                name: "Avocado Toast with Egg",
                keywords: ["avocado toast", "toast"],
                ingredients: ["egg", "bread", "avocado", "toast"],
                description: "A popular, satisfying, and nutritious breakfast or lunch.",
                details: `<strong>Ingredients:</strong><ul><li>1 slice good-quality Bread, toasted</li><li>1/2 Avocado</li><li>1 Egg, cooked your favorite way</li><li>Salt, pepper, and red pepper flakes to taste</li></ul><strong>Instructions:</strong><ol><li>Mash the avocado with a fork and spread it on the toast.</li><li>Season with salt and pepper.</li><li>Top with a sunny-side-up, poached, or fried egg.</li><li>Sprinkle with red pepper flakes if desired.</li></ol>`
            },
            breakfasttacos: {
                name: "Breakfast Tacos",
                keywords: ["breakfast tacos", "taco"],
                ingredients: ["egg", "tortilla", "salsa", "avocado", "cheese", "taco"],
                description: "A fun, flavorful, and satisfying breakfast dish that’s easy to customize.",
                details: `<strong>Ingredients:</strong><ul><li>4 small Corn or Flour Tortillas</li><li>4 Eggs, scrambled</li><li>Toppings: salsa, avocado, cheese, cilantro</li></ul><strong>Instructions:</strong><ol><li>Warm the tortillas in a dry skillet or microwave.</li><li>Prepare scrambled eggs.</li><li>Assemble the tacos by filling each tortilla with eggs and your desired toppings.</li></ol>`
            },
            deviledeggs: {
                name: "Deviled Eggs",
                keywords: ["deviled eggs", "appetizer", "party food"],
                 ingredients: ["egg", "mayonnaise", "mustard", "vinegar"],
                description: "A classic party appetizer that's always a crowd-pleaser.",
                details: `<strong>Ingredients:</strong><ul><li>6 Hard-Boiled Eggs</li><li>3 tbsp Mayonnaise</li><li>1 tsp Dijon Mustard</li><li>1 tsp White Vinegar</li><li>Paprika, for garnish</li></ul><strong>Instructions:</strong><ol><li>Halve the hard-boiled eggs lengthwise. Remove the yolks and place them in a small bowl.</li><li>Mash the yolks with a fork. Mix in the mayonnaise, mustard, and vinegar until smooth. Season with salt and pepper.</li><li>Pipe or spoon the yolk mixture back into the egg white halves.</li><li>Garnish with a sprinkle of paprika.</li></ol>`
            },
             bibimbap: {
                name: "Bibimbap (Korean Mixed Rice)",
                keywords: ["bibimbap", "korean", "rice bowl"],
                 ingredients: ["egg", "rice", "spinach", "carrot", "mushroom", "gochujang"],
                description: "A signature Korean dish. The name translates to 'mixed rice with meat and assorted vegetables.'",
                details: `<strong>Ingredients:</strong><ul><li>1 cup cooked Rice</li><li>Assorted vegetables (spinach, carrots, mushrooms), sautéed</li><li>A sunny-side-up Egg</li><li>Gochujang (Korean chili paste) to taste</li><li>Sesame oil</li></ul><strong>Instructions:</strong><ol><li>Place the hot cooked rice in a bowl.</li><li>Artfully arrange the sautéed vegetables on top of the rice.</li><li>Place a freshly cooked sunny-side-up egg in the center.</li><li>Serve with gochujang and a drizzle of sesame oil. Mix everything together before eating.</li></ol>`
            },
            frittata: {
                name: "Italian Frittata",
                keywords: ["frittata", "italian", "crustless", "quiche", "baked"],
                 ingredients: ["egg", "milk", "cream", "cheese", "veggie", "spinach", "sausage"],
                description: "A versatile Italian egg-based dish similar to a crustless quiche, filled with your choice of ingredients.",
                details: `<strong>Ingredients:</strong><ul><li>8 large Eggs</li><li>1/4 cup Milk or Cream</li><li>1/2 cup Grated Parmesan Cheese</li><li>2 cups of Fillings (e.g., cooked veggies, sausage, spinach)</li><li>1 tbsp Olive Oil</li></ul><strong>Instructions:</strong><ol><li>Preheat oven to 375°F (190°C).</li><li>Whisk eggs, milk, cheese, salt, and pepper.</li><li>In an oven-safe skillet, sauté your fillings.</li><li>Pour egg mixture over the fillings. Cook on stovetop for 3-5 minutes until edges set.</li><li>Transfer to oven and bake for 10-15 minutes until set.</li></ol>`
            }
        },
        tips: [
            "For fluffier scrambled eggs, whisk them vigorously for a full minute to incorporate more air.",
            "A splash of vinegar in your poaching water helps the egg whites coagulate faster, leading to a neater shape.",
            "For easier peeling, use eggs that are a week or two old. The membrane is less attached to the shell."
        ],
        donenessKeywords: {
            soft: ["soft", "runny", "dippy", "4-min"],
            medium: ["medium", "jammy", "creamy", "6-min"],
            hard: ["hard", "set", "firm", "9-min"],
            welldone: ["well-done", "fully-cooked", "12-min"]
        }
    };
    
    // --- Core Timer & UI Functions ---

    const formatTime = (seconds) => {
        const minutes = Math.floor(seconds / 60);
        const remainderSeconds = seconds % 60;
        return `${String(minutes).padStart(2, '0')}:${String(remainderSeconds).padStart(2, '0')}`;
    };

    const updateDisplay = () => {
        UIElements.timerDisplay.textContent = formatTime(AppState.secondsRemaining);
        const progress = AppState.totalSeconds > 0 ? (AppState.totalSeconds - AppState.secondsRemaining) / AppState.totalSeconds : 0;
        const yolkHardness = Math.min(progress / AppState.progressTarget, 1);
        const yolkColorHue = 45 - (yolkHardness * 20); // More dramatic color shift
        const yolkOpacity = 0.8 + (yolkHardness * 0.2);
        
        UIElements.yolk.style.setProperty('--yolk-color', `hsl(${yolkColorHue}, 100%, 50%)`);
        UIElements.yolk.style.setProperty('--yolk-opacity', yolkOpacity);

        document.title = `${formatTime(AppState.secondsRemaining)} - Egg Timer`;
    };

    const calculateTotalSeconds = () => {
        const altitudeValue = Math.max(0, parseInt(UIElements.altitude.value, 10) || 0);
        const quantityValue = Math.max(1, parseInt(UIElements.quantity.value, 10) || 1);
        const sizeAdjustment = parseInt(UIElements.eggSize.value, 10);
        const altitudeAdjustment = Math.floor(AppState.baseTime * (altitudeValue / 10000));
        const quantityAdjustment = Math.floor(AppState.baseTime * ((quantityValue - 1) * 0.05));
        AppState.totalSeconds = AppState.baseTime + sizeAdjustment + altitudeAdjustment + quantityAdjustment;
        resetTimer();
    };

    const finishTimer = () => {
        clearInterval(AppState.countdown);
        UIElements.alarmSound.play();
        AppState.isRunning = false;
        UIElements.startBtn.innerHTML = '<i class="fas fa-play"></i> Start';
    };

    const startTimer = () => {
        if (AppState.isRunning || AppState.secondsRemaining <= 0) return;
        AppState.isRunning = true;
        UIElements.startBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
        
        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({ command: 'start', seconds: AppState.secondsRemaining });
        }
        
        AppState.countdown = setInterval(() => {
            AppState.secondsRemaining--;
            updateDisplay();
            if (AppState.secondsRemaining <= 0) finishTimer();
        }, 1000);
    };

    const stopTimer = () => {
        if (!AppState.isRunning) return;
        clearInterval(AppState.countdown);
        AppState.isRunning = false;
        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({ command: 'stop' });
        }
    };
    
    const resetTimer = () => {
        stopTimer();
        AppState.secondsRemaining = AppState.totalSeconds;
        UIElements.alarmSound.pause();
        UIElements.alarmSound.currentTime = 0;
        UIElements.startBtn.innerHTML = '<i class="fas fa-play"></i> Start';
        updateDisplay();
    };
    
    // --- AI Chat Functions ---
    const addMessageToChat = (message, isUser = false) => {
        const messageElement = document.createElement('div');
        messageElement.classList.add('ai-message', isUser ? 'user-message' : 'ai-message-content');
        messageElement.innerHTML = message;
        UIElements.aiResponse.appendChild(messageElement);
        UIElements.aiResponse.scrollTop = UIElements.aiResponse.scrollHeight;
        return messageElement;
    };

    const showTypingIndicator = () => {
        const typingElement = document.createElement('div');
        typingElement.classList.add('ai-message', 'ai-message-content', 'is-typing');
        typingElement.innerHTML = 'Thinking<span>.</span><span>.</span><span>.</span>';
        UIElements.aiResponse.appendChild(typingElement);
        UIElements.aiResponse.scrollTop = UIElements.aiResponse.scrollHeight;
        return typingElement;
    };
    
    const getAIResponse = (query) => {
        query = query.toLowerCase().replace(/[^a-zA-Z0-9\s-]/g, '').trim();

        // --- NEW: Ingredient-based recommendation logic ---
        const ingredientTriggers = ["i have", "i've got", "i got", "with", "and"];
        if (ingredientTriggers.some(trigger => query.includes(trigger))) {
            let bestMatch = null;
            let maxMatchCount = 0;

            Object.values(EggData.recipes).forEach(recipe => {
                let currentMatchCount = 0;
                recipe.ingredients.forEach(ingredient => {
                    // Check for singular and plural forms for better matching
                    if (query.includes(ingredient) || query.includes(ingredient + 's')) {
                        currentMatchCount++;
                    }
                });

                if (currentMatchCount > maxMatchCount) {
                    maxMatchCount = currentMatchCount;
                    bestMatch = recipe;
                }
            });

            if (bestMatch && maxMatchCount > 1) { // Require at least 2 ingredients for a confident match
                return `Based on your ingredients, you could make <strong>${bestMatch.name}</strong>! ${bestMatch.description} Ask me for the full recipe if that sounds good.`;
            } else {
                 return "That's a good start! If you tell me more about what you have, I can give you a better recommendation. For example, 'I have eggs, cheese, and tortillas.'";
            }
        }
        
        // Timer command check
        if (query.includes("timer") || query.includes("set") || query.includes("start")) {
            for (const doneness in EggData.donenessKeywords) {
                if (EggData.donenessKeywords[doneness].some(keyword => query.includes(keyword))) {
                    const targetElement = document.querySelector(`.egg-type[data-id="${doneness}"]`);
                    if (targetElement) targetElement.click();
                    startTimer();
                    return `Of course! I've set and started the timer for perfect ${doneness}-boiled eggs for you.`;
                }
            }
        }
        
        // Recipe keyword check
        for (const key in EggData.recipes) {
            const recipe = EggData.recipes[key];
            if (recipe.keywords.some(keyword => query.includes(keyword))) {
                return `Excellent choice! <strong>${recipe.name}</strong> is a fantastic dish. ${recipe.description}${recipe.details}`;
            }
        }
        
        // Tip request
        if (query.includes("tip") || query.includes("advice") || query.includes("help") || query.includes("how to")) {
            return `Here's a handy tip: ${EggData.tips[Math.floor(Math.random() * EggData.tips.length)]}`;
        }
        
        // Greeting
        if (["hello", "hi", "hey"].includes(query)) {
            return "Hello there! What amazing egg dish can I help you with today? Feel free to ask me for a recipe or a cooking tip.";
        }

        return "I'm not quite sure about that. You can ask me for a recipe like 'shakshuka', or tell me what ingredients you have so I can recommend something!";
    };

    const handleAIQuery = () => {
        const query = UIElements.aiInput.value.trim();
        if (!query) return;
        addMessageToChat(query, true);
        UIElements.aiInput.value = '';

        const typingIndicator = showTypingIndicator();
        
        setTimeout(() => {
            UIElements.aiResponse.removeChild(typingIndicator);
            addMessageToChat(getAIResponse(query));
        }, 1200);
    };

    // --- Event Handlers & Initialization ---
    
    UIElements.eggTypes.forEach(egg => egg.addEventListener('click', (event) => {
        const selectedEgg = event.currentTarget;
        UIElements.eggTypes.forEach(e => e.classList.remove('selected'));
        selectedEgg.classList.add('selected');
        AppState.baseTime = parseInt(selectedEgg.getAttribute('data-time'), 10);
        AppState.progressTarget = parseFloat(selectedEgg.getAttribute('data-progress-end'));
        calculateTotalSeconds();
    }));

    UIElements.colorPicker.querySelectorAll('.color-option').forEach(option => option.addEventListener('click', (event) => {
        const target = event.currentTarget;
        const primaryColor = target.dataset.primary;
        document.documentElement.style.setProperty('--primary-color', primaryColor);
        UIElements.colorPicker.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
        target.classList.add('selected');
    }));

    UIElements.darkModeToggle.addEventListener('change', () => {
        document.body.classList.toggle('dark-mode');
    });

    UIElements.hideCustomizationBtn.addEventListener('click', () => {
        UIElements.customizationContent.classList.toggle('is-hidden');
    });

    UIElements.startBtn.addEventListener('click', startTimer);
    UIElements.stopBtn.addEventListener('click', stopTimer);
    UIElements.resetBtn.addEventListener('click', resetTimer);
    [UIElements.eggSize, UIElements.altitude, UIElements.quantity].forEach(el => el.addEventListener('input', calculateTotalSeconds));
    UIElements.sendAiBtn.addEventListener('click', handleAIQuery);
    UIElements.aiInput.addEventListener('keypress', (e) => e.key === 'Enter' && handleAIQuery());
    
    // Initial Setup
    if ('Notification' in window) Notification.requestPermission();
    calculateTotalSeconds();
});
</script>

<!-- Service worker definition -->
<script>
    // This self-contained script will be registered as the service worker.
    const swCode = `
    let timerTimeout;

    self.addEventListener('message', event => {
        const { command, seconds } = event.data;
        if (command === 'start') {
            clearTimeout(timerTimeout); 
            timerTimeout = setTimeout(() => {
                self.registration.showNotification('Eggs are Ready!', {
                    body: 'Your perfectly cooked eggs are waiting for you.',
                    icon: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Cpath fill="%23ff9f43" d="M50 0C22.4 0 0 22.4 0 50s22.4 50 50 50 50-22.4 50-50S77.6 0 50 0z"/%3E%3C/svg%3E'
                });
            }, seconds * 1000);
        } else if (command === 'stop') {
            clearTimeout(timerTimeout);
        }
    });
    `;
    const blob = new Blob([swCode], { type: 'application/javascript' });
    const swUrl = URL.createObjectURL(blob);
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register(swUrl).then(reg => {
            console.log('Inline Service Worker registered successfully.');
        }).catch(error => {
            console.log('Inline Service Worker registration failed:', error);
        });
    }
</script>

</body>
</html>
